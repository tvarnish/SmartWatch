/* 
   Smart Watch Project
   Analogue Clock
   Thomas Varnish
*/

/* INCLUDES */
#include <G4D.h>
#include <SoftwareSerial.h>

#define POWER_PIN    8
#define RESET_PIN    9
#define SOFT_TX      3
#define SOFT_RX      2

SoftwareSerial oledSerial(SOFT_RX, SOFT_TX);
G4D display(POWER_PIN,RESET_PIN,&oledSerial);

/* VARIABLES */
const int originx = 64;
const int originy = 64;

float x;
float y;

float sx; float sy;
float mx; float my;
float hx; float hy;

int time;
int s;
int m;
int h;

/* FUNCTIONS */
void ColourBackground()
{
  display.setBackground(50, 50, 88);
}

void DrawClockFace(int x, int i)
{
  display.circle(64, 64, x, 255, 255, 255);  // Draw White Circle
  display.circle(64, 64, x - i, 0, 0, 0);  // Draw Black Circle that is 'i' pixels smaller than the white one.
}

int DrawHand(int time)
{
  if (time == 0)
  {
    x = 64; y = 6;
  }
  else
  {
    switch (time) 
    {
      case 1:
        x = 70.06; y = 6.318;
        break;
      case 2:
        x = 76.06; y = 7.267;
        break;
      case 3:
        x = 81.92; y = 8.839;
        break;
      case 4:
        x = 87.59; y = 11.01;
        break;
      case 5:
        x = 93; y = 13.77;
        break;
      case 6:
        x = 98.09; y = 17.08;
        break;
      case 7:
        x = 102.8; y = 20.9;
        break;
      case 8:
        x = 107.1; y = 25.19;
        break;
      case 9:
        x = 110.9; y = 29.91;
        break;
      case 10:
        x = 114.2; y = 35;
        break;
      case 11:
        x = 117; y = 40.41;
        break;
      case 12:
        x = 119.2; y = 46.08;
        break;
      case 13:
        x = 120.7; y = 51.94;
        break;
      case 14:
        x = 121.7; y = 57.94;
        break;
      case 15:
        x = 122; y = 64;
        break;
      // ************************************* //
      case 16:
        x = 121.7; y = 70.06;
        break;
      case 17:
        x = 120.7; y = 76.06;
        break;
      case 18:
        x = 119.2; y = 81.92;
        break;
      case 19:
        x = 117; y = 87.59;
        break;
      case 20:
        x = 114.2; y = 93;
        break;
      case 21:
        x = 110.09; y = 98.09;
        break;
      case 22:
        x = 107.1; y = 102.8;
        break;
      case 23:
        x = 102.8; y = 107.1;
        break;
      case 24:
        x = 98.09; y = 110.9;
        break;
      case 25:
        x = 93; y = 114.2;
        break;
      case 26:
        x = 87.59; y = 117;
        break;
      case 27:
        x = 81.92; y = 119.2;
        break;
      case 28:
        x = 76.06; y = 120.7;
        break;
      case 29:
        x = 70.06; y = 121.7;
        break;
      case 30:
        x = 64; y = 122;
        break;
      // ************************************* //
      case 31:
        x = 57.94; y = 121.7;
        break;
      case 32:
        x = 51.94; y = 120.7;
        break;
      case 33:
        x = 46.08; y = 119.2;
        break;
      case 34:
        x = 40.41; y = 117;
        break;
      case 35:
        x = 35; y = 114.2;
        break;
      case 36:
        x = 29.91; y = 110.9;
        break;
      case 37:
        x = 25.19; y = 107.1;
        break;
      case 38:
        x = 20.9; y = 102.8;
        break;
      case 39:
        x = 17.08; y = 98.09;
        break;
      case 40:
        x = 13.77; y = 93;
        break;
      case 41:
        x = 11.01; y = 87.59;
        break;
      case 42:
        x = 8.839; y = 81.92;
        break;
      case 43:
        x = 7.267; y = 76.06;
        break;
      case 44:
        x = 6.318; y = 70.06;
        break;
      case 45:
        x = 6; y = 64;
        break;
      // ************************************* //
      case 46:
        x = 6.318; y = 57.94;
        break;
      case 47:
        x = 7.267; y = 51.94;
        break;
      case 48:
        x = 8.839; y = 46.08;
        break;
      case 49:
        x = 11.01; y = 40.41;
        break;
      case 50:
        x = 13.77; y = 35;
        break;
      case 51:
        x = 17.08; y = 29.91;
        break;
      case 52:
        x = 20.9; y = 25.19;
        break;
      case 53:
        x = 25.19; y = 20.9;
        break;
      case 54:
        x = 29.91; y = 17.08;
        break;
      case 55:
        x = 35; y = 13.77;
        break;
      case 56:
        x = 40.41; y = 11.01;
        break;
      case 57:
        x = 46.08; y = 8.839;
        break;
      case 58:
        x = 51.94; 7.267;
        break;
      case 59:
        x = 57.94; y = 6.318;
        break;
    }
    
    display.line(originx, originy, x, y, 255, 0, 0);
    delay(1000);
    display.line(originx, originy, x, y, 0, 0, 0);
  }  
  
  return x, y;
}

void DrawClockLines()
{
  display.line( 64, 124, 64, 114, 255, 255, 255);
  display.line( 64, 4, 64, 14, 255, 255, 255);
  display.line( 124, 64, 114, 64, 255, 255, 255);
  display.line( 4, 64, 14, 64, 255, 255, 255);
}

/* MAIN PROGRAM */
void setup()
{  
        Serial.begin(9600);
        delay(100);
        
  	oledSerial.begin(57600);

	display.powerUp();
        display.clear();
        DrawClockFace(60, 1);
        //DrawClockLines();  
}

void loop()
{
  for (int i = 0; i < 60; i ++)
  {
   //sx, sy = DrawHand(i);
   //mx, my = DrawHand(m);
   //hx, hy = DrawHand(h);
   
   //display.line(originx, originy, sx, sy, 255, 0, 0);
   //display.line(originx, originy, mx, my, 0, 255, 0);
   //display.line(originx, originy, hx, hy, 0, 0, 255);
   
   //delay(1000);
   
   //display.line(originx, originy, sx, sy, 0, 0, 0);
   //display.line(originx, originy, mx, my, 0, 0, 0);
   //display.line(originx, originy, hx, hy, 0, 0, 0);
   
   DrawHand(i);
  }
}
